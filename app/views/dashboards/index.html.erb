<h1>Dashboard</h1>
User_id: <%= @user_id %>
<br>
<%= link_to 'Add Bill', new_bill_path, remote: true, class: "btn btn-primary active", 'data-toggle':"collapse", 'href': "#newBillWindow",  'aria-expanded': "false", 'aria-controls'=>"newBillWindow" %>
<%= link_to 'Logout', logout_path, method: :delete, class: "btn btn-warning active" %><br>
<%# Collapsable Content%>
  <div class="collapse" id="newBillWindow">
    <div class="container-fluid">
      <div class="row">
        <div class="col-sm-12">
          <div class="col-sm-6">
            <%= form_for @newBill, remote:true, url: bills_path, :html => { id:"addBill"} do |f| %>
            <div class="col-sm-6">
              <%= f.label :title, 'Bill Title :' %> <br>
              <%= f.text_field :title, placeholder: "Drinks at Tony's" %><br>
            </div>
            <div class="col-sm-6">
              <%= f.label :total_price, "Total Amount ($):" %> <br>
              <%= f.text_field :total_price, placeholder: "543.21" %> <br>
            </div>
          </div>
        </div>
        <div class="col-sm-12">
          <div class="col-sm-12"> <br>
            <div class="col-md-6 col-sm-12 ">
              <%= f.text_area :description, placeholder: "Describe the occasion!", id:"newBillDesc" %>
            </div>
          </div>
        </div>
        <div class="col-sm-6">
          <div class="col-sm-12">
            <div class="col-sm-10">
            <%= f.label :due, 'Due on:' %>
            <%= f.date_select(:due, use_short_month: true, order:[:day, :month, :year]) %>
            </div>
            <div class="col-sm-2">
              <%= f.submit "Save Bill", class: 'btn btn-success', id: "saveBill-btn"%>
              <%end%>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
      </div>
    </div>
  </div><br> <%# END of collapsable content %>

<div class="divider"></div>

  <div class="container-fluid">
    <div class="row" id="billBook">
      <%# START Bill Cards %>
        <% @bills.each do |bill| %>
          <div class="col-md-4">
            <div class="col-xs-12">
                <div class="card" id="card_<%=bill.id%>">
                <%# Start Nav Tabs Block %>
                  <div class="card-header text-xs-center">
                    <ul class="nav nav-tabs card-header-tabs" role="tablist">
                      <li class="nav-item">
                        <a class="nav-link active" data-toggle="tab" href="#view_card_<%=bill.id%>" role="tab">View</a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#items_card_<%=bill.id%>" role="tab">Items</a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#details_card_<%=bill.id%>" role="tab">Details</a>
                      </li>
                    </ul>
                  </div>
                  <%# END of Nav Tabs %>
                <%# Start Tab panes %>
                  <div class="card-block tab-content">

                      <div id="view_card_<%=bill.id%>" class="tab-pane active text-xs-left " role="tabpanel">
                        <div class="imgHolder">
                          <img class="card-img-top cardImg" src="https://mave.me/img/projects/full_placeholder.png" alt="Card image cap">
                          <p class="card-title billTitle"> <%=bill.title%> </p>
                        </div>
                        <div class="col-md-12">
                          <span>$0</span> / <span class="billTotal">$<%=bill.total_price%></span>
                        </div>
                        <div class="col-md-12">
                          <%=@all_bill_items[bill.id].length%> items
                        </div>
                        <div class="col-md-12">
                          <% if bill.clear == false
                            status = ' On going'
                          else
                            status = ' Cleared '
                          end %>
                          Status: <%=status%>
                        </div>
                      </div>

                      <div id="items_card_<%=bill.id%>" class="tab-pane" role="tabpanel">
                        <a class="btn btn-outline-success btn-sm addItem" data-toggle="collapse" href="#addItemCollapse_<%=bill.id%>" aria-expanded="false" aria-controls="addItem">
                          <i id="test" class="fa fa-plus-circle" aria-hidden="true"></i> Item </a>

                          <%# START Collapse new item form %>
                          <div class="collapse" id="addItemCollapse_<%=bill.id%>">
                            <%= form_for @newItem, remote: true, url: items_path, :html => { class:"newItemForm", id:"newItemForm_#{bill.id}"} do |f| %>
                            <%= hidden_field(:item, :bill_id, options={ :value => bill.id } ) %>
                            <%= f.text_field :item_name, placeholder: "New Item" %><br>
                            <%= f.text_field :item_price, placeholder: "($)"%><br>
                            <%= f.submit "Save", class: 'btn btn-outline-primary btn-sm submit_item', id: "saveItem-btn-"+bill.id.to_s%>
                            <% end %>
                          </div>
                          <%# end Collapse new item form %>
                        <%# List bill items here %>
                        <div class="items_list" id="items_card_list_<%=bill.id%>">
                          <% @all_bill_items[bill.id].each do |item| %>
                          <div class='bill_item'>
                              <div class="col-sm-9">
                                <div><%=item.item_name%></div>
                                <div>$<%=item.item_price%></div>
                              </div>

                              <div class="tagPayee-input-holder col-sm-3" id='tagPayee-input-holder-<%=bill.id%>'>
                                <a id="tagPayeeItem-<%=item.id%>" billID="<%=bill.id%>" itemID="<%=item.id%>" href="" class="btn btn-outline-info btn-sm tagPayee" role="button">
                                  <i class="fa fa-user-plus" aria-hidden="true"></i> </a>
                              </div>
                          </div>

                          <% end %>
                          <div id="tagPayeeItemFrame-<%=bill.id%>" class="tagPayeeItemFrame">
                            <%# Button to close tagPayeeItemFrame %>
                            <button class=" closeTagPayeeItemFrame btn btn-sm btn-outline-danger" billID="<%=bill.id%>"><i class="fa fa-times-circle-o" aria-hidden="true"></i></button>

                              Tag User Here

                          </div>
                        </div>

                      </div>

                      <div id="details_card_<%=bill.id%>" class="tab-pane text-xs-left" role="tabpanel">
                        <p> Due on: <%=bill.due%> </p>
                        <p> <%=bill.description%> </p> </div>
                  </div>
                  <%# END Tab panes %>
                </div>
              </div>
            </div>
        <%end%>
      <%# END Bill Cards %>
    </div>
  </div>

<%# Ajax Card Template %>
    <template id="billTemplate">
      <div class="col-md-4">
        <div class="col-xs-12">
            <div class="card" id="template_card">
              <%# START Nav Tabs Block %>
              <div class="card-header text-xs-center">
                <ul class="nav nav-tabs card-header-tabs" role="tablist">
                  <li class="nav-item">
                    <a id="template_viewLink" class="nav-link active" data-toggle="tab" role="tab">View</a> </li>
                  <li class="nav-item">
                    <a id="template_itemsLink" class="nav-link" data-toggle="tab" role="tab">Items</a> </li>
                  <li class="nav-item">
                    <a id="template_detailsLink" class="nav-link" data-toggle="tab" role="tab">Details</a> </li>
                </ul>
              </div>
              <%# END Nav Tabs Block %>
              <%# Start Tab panes %>
                <div class="card-block tab-content">
                    <div id='template_viewPane' class="tab-pane active text-xs-left" role="tabpanel">
                      <div class="imgHolder">
                        <img class="card-img-top cardImg" src="https://mave.me/img/projects/full_placeholder.png" alt="Card image cap">
                        <p class="card-title billTitle" id="template_billTitle"></p>
                      </div>
                      <div class="col-md-12">
                        <span>$0</span> / <span id="template_billTotal" ></span>
                      </div>
                      <div class="col-md-12">
                        Status: Under Construction
                      </div>
                    </div>

                    <div id="template_itemsPane" class="tab-pane" role="tabpanel">
                      items pane
                      <a href="#test" class="btn btn-primary active">
                        Add Items Feature </a>
                    </div>

                    <div id="template_detailsPane"  class="tab-pane" role="tabpanel">
                      <p id="template_due"> Due on: **Under Construction** </p>
                      <p id="template_details" >
                        **Bill Description...** </p>
                    </div>
                </div>
              <%# END Tab panes %>
            </div>
          <%# END of Nav Tabs %>
          </div>
        </div>
    </template>
<%# END Ajax Card Template %>


<%# Ajax Payee Input Template%>
  <template id="template_tagPayee_input">
    <div class='input-payee-form'>
        <input id="payee_email" type="text" name="payee_email" placeholder="Payee's email" >
        <input id="payee_amt" type="text" name="payee_amt" placeholder="($)Amount">
        <button type="button" class="btn btn-sm btn-outline-success">
        <i class="fa fa-user-plus" aria-hidden="true"></i> </button>
    </div>
  </template>

<%# Ajax Payee Input Template%>
